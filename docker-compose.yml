version: '3.8'

services:
  etl-pipeline:
    build: .
    container_name: mongo-to-postgres-etl
    restart: unless-stopped
    environment:
      - MONGO_HOST=localhost
      - MONGO_PORT=27017
      - MONGO_DB=arc-one
      - MONGO_USER=root
      - MONGO_PASSWORD=admin123
      - MONGO_AUTH_DB=arc-one
      - POSTGRES_HOST=localhost
      - POSTGRES_PORT=5432
      - POSTGRES_DB=target_database_prod2
      - POSTGRES_USER=user-name
      - POSTGRES_PASSWORD=strong-password
      - ETL_BATCH_SIZE=1000
      - ETL_SAMPLE_SIZE=100
      - ETL_MAX_RETRIES=3
      - ETL_RETRY_DELAY=5
      - ETL_CONNECTION_TIMEOUT=30
      - ETL_LOG_LEVEL=INFO
      - ETL_LOG_FILE=/app/logs/etl_pipeline.log
      - ETL_SKIP_VIEWS=true
      - ETL_SKIP_SYSTEM=true
      - ETL_OVERRIDE_TABLES=false
      - ETL_SYNC_DURATION=1
    volumes:
      - ./logs:/app/logs
      - ./metrics:/app/metrics
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s